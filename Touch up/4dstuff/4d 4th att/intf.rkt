#lang racket
(require 2htdp/universe)
(require (planet wmfarr/plt-linalg:1:13/matrix))
(require "ndpoly-rot.rkt")
(require "globalstruct.rkt")
(require "ndpoly-op.rkt")
(require "progwor.rkt")
(require "triop.rkt")
(require "worldop.rkt")
(require "opvec.rkt")
(provide (all-defined-out))

(define rel #f)
(define ref 1);0->

(define (keys wor str)
  (cond
    ((string=? str "o") (begin (set! rel #f) wor))
    ((string=? str "p") (begin (set! rel #t) wor))
    ((string->number str) (begin (set! ref (string->number str)) wor))
   (else (if rel
             (cond
    ((string=? str "q") (if (= 0 ref) (mov-cam-rel wor (ll->mat '((0 0 1))) 1) 
                            (mov-ob-rel wor 2 1 (sub1 ref))))
    ((string=? str "e") (if (= 0 ref) (mov-cam-rel wor (ll->mat '((0 0 1))) -1) 
                            (mov-ob-rel wor 2 -1 (sub1 ref))))
    ((string=? str "w") (if (= 0 ref) (mov-cam-rel wor (ll->mat '((0 1 0))) 1) 
                            (mov-ob-rel wor 1 1 (sub1 ref))))
    ((string=? str "s") (if (= 0 ref) (mov-cam-rel wor (ll->mat '((0 1 0))) -1)
                            (mov-ob-rel wor 1 -1 (sub1 ref))))
    ((string=? str "a") (if (= 0 ref) (mov-cam-rel wor (ll->mat '((1 0 0))) 1)
                            (mov-ob-rel wor 0 1 (sub1 ref))))
    ((string=? str "d") (if (= 0 ref) (mov-cam-rel wor (ll->mat '((1 0 0))) -1)
                            (mov-ob-rel wor 0 -1 (sub1 ref))))
    ((string=? str "z") (if (= 0 ref) (rot-cam-rel wor 0 1 (/ pi 8)) 
                            (rot-ob-rel wor 0 1 (/ pi 8) (sub1 ref))))
    ((string=? str "x") (if (= 0 ref) (rot-cam-rel wor 0 2 (/ pi 8)) 
                            (rot-ob-rel wor 0 2 (/ pi 8) (sub1 ref))))
    ((string=? str "c") (if (= 0 ref) (rot-cam-rel wor 1 2 (/ pi 8)) 
                            (rot-ob-rel wor 0 3 (/ pi 8) (sub1 ref))))
    ((string=? str "v") (if (= 0 ref) (rot-cam-rel wor 0 1 (/ pi 8)) 
                            (rot-ob-rel wor 1 2 (/ pi 8) (sub1 ref))))
    ((string=? str "b") (if (= 0 ref) (rot-cam-rel wor 0 2 (/ pi 8)) 
                            (rot-ob-rel wor 1 3 (/ pi 8) (sub1 ref))))
    ((string=? str "n") (if (= 0 ref) (rot-cam-rel wor 1 2 (/ pi 8)) 
                            (rot-ob-rel wor 2 3 (/ pi 8) (sub1 ref))))
    ;(else (error '1 "hi"))
    )
             (cond
    ((string=? str "q") (if (= 0 ref) (mov-cam-abs wor (ll->mat '((0 0 1))) 1) 
                            (mov-ob-abs wor (ll->mat '((0 0 1))) 1 (sub1 ref))))
    ((string=? str "e") (if (= 0 ref) (mov-cam-abs wor (ll->mat '((0 0 1))) -1) 
                            (mov-ob-abs wor (ll->mat '((0 0 1))) -1 (sub1 ref))))
    ((string=? str "w") (if (= 0 ref) 
                            (mov-cam-abs wor (ll->mat '((0 1 0))) 1) 
                            (mov-ob-abs wor (ll->mat '((0 1 0))) 1 (sub1 ref))))
    ((string=? str "s") (if (= 0 ref) (mov-cam-abs wor (ll->mat '((0 1 0))) -1)
                            (mov-ob-abs wor (ll->mat '((0 1 0))) -1 (sub1 ref))))
    ((string=? str "a") (if (= 0 ref) (mov-cam-abs wor (ll->mat '((1 0 0))) 1)
                            (mov-ob-abs wor (ll->mat '((1 0 0))) 1 (sub1 ref))))
    ((string=? str "d") (if (= 0 ref) (mov-cam-abs wor (ll->mat '((1 0 0))) -1)
                            (mov-ob-abs wor (ll->mat '((1 0 0))) -1 (sub1 ref))))
    ((string=? str "z") (if (= 0 ref) (rot-cam-abs wor 0 1 (/ pi 8)) 
                            (rot-ob-abs wor 0 1 (/ pi 8) (sub1 ref))))
    ((string=? str "x") (if (= 0 ref) (rot-cam-abs wor 0 2 (/ pi 8)) 
                            (rot-ob-abs wor 0 2 (/ pi 8) (sub1 ref))))
    ((string=? str "c") (if (= 0 ref) (rot-cam-rel wor 1 2 (/ pi 8)) 
                            (rot-ob-rel wor 0 3 (/ pi 8) (sub1 ref))))
    ((string=? str "v") (if (= 0 ref) (rot-cam-rel wor 0 1 (/ pi 8)) 
                            (rot-ob-rel wor 1 2 (/ pi 8) (sub1 ref))))
    ((string=? str "b") (if (= 0 ref) (rot-cam-rel wor 0 2 (/ pi 8)) 
                            (rot-ob-rel wor 1 3 (/ pi 8) (sub1 ref))))
    ((string=? str "n") (if (= 0 ref) (rot-cam-rel wor 1 2 (/ pi 8)) 
                            (rot-ob-rel wor 2 3 (/ pi 8) (sub1 ref))))
    ;(else (error '1 "hi"))
    )))))


(define (change wor)
  wor)



;(define worl (world (cam-obj (l->mat '(0 0 0)) (matrix-identity 3))
 ;                   (vector
  ;                   (obj (ndpoly 
   ;                     (matrix 3 1 0 0 50) (matrix-identity 3) 
    ;                    (vector (l->mat '(-20 -20 30)) (l->mat '(20 -20 30)) (l->mat '(-20 20 30)) (l->mat '(20 20 30))
     ;                           (l->mat '(-20 -20 70)) (l->mat '(20 -20 70)) (l->mat '(-20 20 70)) (l->mat '(20 20 70)))
      ;               (list (reftri 0 1 2 (triarray 1 (vector (vector #"\100\100\100\100")))) (reftri 1 2 3 (triarray 1 (vector (vector #"\100\100\100\100"))))
       ;                    (reftri 4 5 6 (triarray 1 (vector (vector #"\0\0\177\0")))) (reftri 5 6 7 (triarray 1 (vector (vector #"\0\0\177\0"))))
        ;                   (reftri 0 1 4 (triarray 1 (vector (vector #"\0\177\0\0")))) (reftri 1 4 5 (triarray 1 (vector (vector #"\0\177\0\0"))))
         ;                  (reftri 2 3 6 (triarray 1 (vector (vector #"\0\0\0\177")))) (reftri 3 6 7 (triarray 1 (vector (vector #"\0\0\0\177"))))
          ;                 (reftri 0 2 4 (triarray 1 (vector (vector #"\0\177\177\0")))) (reftri 2 4 6 (triarray 1 (vector (vector #"\0\177\177\0"))))
           ;                (reftri 1 3 5 (triarray 1 (vector (vector #"\0\177\0\177")))) (reftri 3 5 7 (triarray 1 (vector (vector #"\0\177\0\177"))))
            ;               )))
             ;        )))
(define worl (world (cam-obj (l->mat '(0 0 0 0)) (matrix-identity 4))
                   (vector
                     (obj (ndpoly 
                        (matrix 4 1 0 0 50 50) (matrix-identity 4) 
                        (vector (l->mat '(-20 -20 30 30)) (l->mat '(20 -20 30 30)) (l->mat '(-20 20 30 30)) (l->mat '(20 20 30 30))
                                (l->mat '(-20 -20 70 30)) (l->mat '(20 -20 70 30)) (l->mat '(-20 20 70 30)) (l->mat '(20 20 70 30))
                                
                                (l->mat '(-20 -20 30 70)) (l->mat '(20 -20 30 70)) (l->mat '(-20 20 30 70)) (l->mat '(20 20 30 70))
                                (l->mat '(-20 -20 70 70)) (l->mat '(20 -20 70 70)) (l->mat '(-20 20 70 70)) (l->mat '(20 20 70 70)))
                     (list (reftri 0 1 2 (triarray 1 (vector (vector #"\100\100\100\100")))) (reftri 1 2 3 (triarray 1 (vector (vector #"\100\100\100\100"))))
                           (reftri 4 5 6 (triarray 1 (vector (vector #"\0\0\177\0")))) (reftri 5 6 7 (triarray 1 (vector (vector #"\0\0\177\0"))))
                           (reftri 0 1 4 (triarray 1 (vector (vector #"\0\177\0\0")))) (reftri 1 4 5 (triarray 1 (vector (vector #"\0\177\0\0"))))
                           (reftri 2 3 6 (triarray 1 (vector (vector #"\100\100\100\100")))) (reftri 3 6 7 (triarray 1 (vector (vector #"\0\0\0\177"))))
                           (reftri 0 2 4 (triarray 1 (vector (vector #"\100\100\100\100")))) (reftri 2 4 6 (triarray 1 (vector (vector #"\0\177\177\0"))))
                           (reftri 1 3 5 (triarray 1 (vector (vector #"\100\100\100\100")))) (reftri 3 5 7 (triarray 1 (vector (vector #"\0\177\0\177"))))
                           
                           (reftri 8 9 10 (triarray 1 (vector (vector #"\100\100\100\100")))) (reftri 9 10 11 (triarray 1 (vector (vector #"\100\100\100\100"))))
                           (reftri 12 13 14 (triarray 1 (vector (vector #"\0\0\177\0")))) (reftri 13 14 15 (triarray 1 (vector (vector #"\0\0\177\0"))))
                           (reftri 8 9 12 (triarray 1 (vector (vector #"\0\177\0\0")))) (reftri 8 12 13 (triarray 1 (vector (vector #"\0\177\0\0"))))
                           (reftri 10 11 14 (triarray 1 (vector (vector #"\0\0\0\177")))) (reftri 11 14 15 (triarray 1 (vector (vector #"\0\0\0\177"))))
                           (reftri 8 10 12 (triarray 1 (vector (vector #"\0\177\177\0")))) (reftri 10 12 14 (triarray 1 (vector (vector #"\0\177\177\0"))))
                           (reftri 9 11 13 (triarray 1 (vector (vector #"\0\177\0\177")))) (reftri 11 13 15 (triarray 1 (vector (vector #"\0\177\0\177"))))
                        
                           
                           )))
                     )))

;(define (big)
 ; (set! worl (change (change worl)))
  ;(place-scene worl))
(place-scene worl)
(define (bang str)
  (set! worl (keys worl str))
  (place-scene worl))